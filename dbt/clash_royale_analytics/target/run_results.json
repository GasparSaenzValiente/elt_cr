{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-11-20T22:55:16.840533Z", "invocation_id": "b9e64baa-dfcf-4d4a-82ff-90f3b73b9795", "invocation_started_at": "2025-11-20T22:55:15.378863Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.145885Z", "completed_at": "2025-11-20T22:55:16.170041Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.180970Z", "completed_at": "2025-11-20T22:55:16.375222Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.2841513156890869, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_clan_members", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_members\"\n)\nselect distinct on (clan_tag, member_tag, snapshot_date)\n    cast(clan_tag as varchar(10)) as clan_tag,\n    cast(member_tag as varchar(10)) as member_tag,\n    cast(member_role as varchar(25)) as member_role,\n    cast(member_clan_rank as smallint) as member_rank,\n    cast(member_exp_level as smallint) as member_exp_level,\n    member_donations,\n    donations_received as member_donations_received,\n    year,\n    month,\n    day,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by clan_tag, member_tag, snapshot_date", "relation_name": "\"cr_db\".\"public\".\"stg_clan_members\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.098952Z", "completed_at": "2025-11-20T22:55:16.145191Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.149190Z", "completed_at": "2025-11-20T22:55:16.380749Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.3225398063659668, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_battle_info", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_battle_info\"\n)\nselect distinct on (battle_id, player_tag)\n    cast(battle_id as varchar(64)) as battle_id,\n    cast(battle_time as timestamp) as battle_time,\n    game_mode_id,\n    cast(game_mode_name as varchar(50)) as game_mode_name,\n    is_ladder_tournament,\n    is_hosted_match,\n    \n    cast(player_tag as varchar(9)) as player_tag,\n    cast(player_elixir_leaked as smallint) as player_elixir_leaked,\n    cast(player_king_tower_hit_points as smallint) as player_king_tower_hp,\n    coalesce(cast(player_princess_tower_hit_points[1] as smallint), 0) as player_left_tower_hp,\n    coalesce(cast(player_princess_tower_hit_points[2] as smallint), 0) as player_right_tower_hp,\n    coalesce(cast(player_trophy_change as smallint), 0) as player_trophy_change,\n    cast(player_crowns as smallint) as player_crowns,\n\n    cast(opp_tag as varchar(9)) as opp_tag,\n    cast(opp_elixir_leaked as smallint) as opp_elixir_leaked,\n    cast(opp_king_tower_hit_points as smallint) as opp_king_tower_hp,\n    coalesce(cast(opp_princess_tower_hit_points[1] as smallint), 0) as opp_left_tower_hp,\n    coalesce(cast(opp_princess_tower_hit_points[2] as smallint), 0) as opp_right_tower_hp,\n    coalesce(cast(opp_trophy_change as smallint), 0) as opp_trophy_change,\n    cast(opp_crowns as smallint) as opp_crowns,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by battle_id, player_tag", "relation_name": "\"cr_db\".\"public\".\"stg_battle_info\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.102121Z", "completed_at": "2025-11-20T22:55:16.148792Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.164921Z", "completed_at": "2025-11-20T22:55:16.376762Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.3177499771118164, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_cards", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_cards\"\n)\nselect \n    card_id,\n    cast(card_name as varchar(50)) as card_name,\n    cast(rarity as varchar(9)) as card_rarity,\n    cast(max_level as smallint) as card_max_level,\n    coalesce(cast(elixir_cost as smallint),0) as card_elixir_cost,\n    coalesce(cast(max_evolution_level as smallint), 0) as card_max_evolution_level\nfrom source_data\norder by card_id", "relation_name": "\"cr_db\".\"public\".\"stg_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.062871Z", "completed_at": "2025-11-20T22:55:16.278395Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.278856Z", "completed_at": "2025-11-20T22:55:16.426906Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.3693878650665283, "adapter_response": {"_message": "SELECT 5417", "code": "SELECT", "rows_affected": 5417}, "message": "SELECT 5417", "failures": null, "unique_id": "model.clash_royale_analytics.dim_date", "compiled": true, "compiled_code": "\n    \nwith base_dates as (\n    \n    with date_spine as\n(\n\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n     + \n    \n    p11.generated_number * power(2, 11)\n     + \n    \n    p12.generated_number * power(2, 12)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n     cross join \n    \n    p as p12\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 5417\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n\n    cast('2016-03-02' as timestamp) + ((interval '1 day') * ((row_number() over (order by 1) - 1)))\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast('2030-12-31' as timestamp)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    cast(d.date_day as timestamp) as date_day\nfrom\n    date_spine d\n\n\n),\ndates_with_prior_year_dates as (\n\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n\n    d.date_day + ((interval '1 year') * (-1))\n\n as date) as prior_year_date_day,\n        cast(\n\n    d.date_day + ((interval '1 day') * (-364))\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n\n)\nselect\n    d.date_day,\n    cast(\n\n    d.date_day + ((interval '1 day') * (-1))\n\n as date) as prior_date_day,\n    cast(\n\n    d.date_day + ((interval '1 day') * (1))\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    -- Monday(1) to Sunday (7)\n        cast(date_part('isodow', d.date_day) as integer) as day_of_week,\n\n    to_char(d.date_day, 'FMDay') as day_of_week_name,\n    to_char(d.date_day, 'FMDy') as day_of_week_name_short,\n    date_part('day', d.date_day) as day_of_month,\n    date_part('doy', d.date_day) as day_of_year,\n\n    -- Sunday as week start date\ncast(\n\n    date_trunc('week', \n\n    d.date_day + ((interval '1 day') * (1))\n\n) + ((interval '1 day') * (-1))\n\n as date) as week_start_date,\n    cast(\n\n    -- Sunday as week start date\ncast(\n\n    date_trunc('week', \n\n    d.date_day + ((interval '1 day') * (1))\n\n) + ((interval '1 day') * (-1))\n\n as date) + ((interval '1 day') * (6))\n\n as date) as week_end_date,\n    -- Sunday as week start date\ncast(\n\n    date_trunc('week', \n\n    d.prior_year_over_year_date_day + ((interval '1 day') * (1))\n\n) + ((interval '1 day') * (-1))\n\n as date) as prior_year_week_start_date,\n    cast(\n\n    -- Sunday as week start date\ncast(\n\n    date_trunc('week', \n\n    d.prior_year_over_year_date_day + ((interval '1 day') * (1))\n\n) + ((interval '1 day') * (-1))\n\n as date) + ((interval '1 day') * (6))\n\n as date) as prior_year_week_end_date,\n    \ncast(to_char(d.date_day, 'WW') as integer) as week_of_year,\n\n    cast(date_trunc('week', d.date_day) as date) as iso_week_start_date,\n    cast(\n\n    cast(date_trunc('week', d.date_day) as date) + ((interval '1 day') * (6))\n\n as date) as iso_week_end_date,\n    cast(date_trunc('week', d.prior_year_over_year_date_day) as date) as prior_year_iso_week_start_date,\n    cast(\n\n    cast(date_trunc('week', d.prior_year_over_year_date_day) as date) + ((interval '1 day') * (6))\n\n as date) as prior_year_iso_week_end_date,\n    -- postgresql week is isoweek, the first week of a year containing January 4 of that year.\ncast(date_part('week', d.date_day) as integer) as iso_week_of_year,\n\n    \ncast(to_char(d.prior_year_over_year_date_day, 'WW') as integer) as prior_year_week_of_year,\n    -- postgresql week is isoweek, the first week of a year containing January 4 of that year.\ncast(date_part('week', d.prior_year_over_year_date_day) as integer) as prior_year_iso_week_of_year,\n\n    cast(date_part('month', d.date_day) as integer) as month_of_year,\n    to_char(d.date_day, 'FMMonth')  as month_name,\n    to_char(d.date_day, 'FMMon')  as month_name_short,\n\n    cast(date_trunc('month', d.date_day) as date) as month_start_date,\n    cast(cast(\n        \n\n    \n\n    date_trunc('month', d.date_day) + ((interval '1 month') * (1))\n\n + ((interval '1 day') * (-1))\n\n\n        as date) as date) as month_end_date,\n\n    cast(date_trunc('month', d.prior_year_date_day) as date) as prior_year_month_start_date,\n    cast(cast(\n        \n\n    \n\n    date_trunc('month', d.prior_year_date_day) + ((interval '1 month') * (1))\n\n + ((interval '1 day') * (-1))\n\n\n        as date) as date) as prior_year_month_end_date,\n\n    cast(date_part('quarter', d.date_day) as integer) as quarter_of_year,\n    cast(date_trunc('quarter', d.date_day) as date) as quarter_start_date,\n    \n    cast(\n\n    \n\n    date_trunc('quarter', d.date_day) + ((interval '1 month') * (3))\n\n + ((interval '1 day') * (-1))\n\n as date) as quarter_end_date,\n\n    cast(date_part('year', d.date_day) as integer) as year_number,\n    cast(date_trunc('year', d.date_day) as date) as year_start_date,\n    cast(cast(\n        \n\n    \n\n    date_trunc('year', d.date_day) + ((interval '1 year') * (1))\n\n + ((interval '1 day') * (-1))\n\n\n        as date) as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n", "relation_name": "\"cr_db\".\"public\".\"dim_date\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.400463Z", "completed_at": "2025-11-20T22:55:16.405096Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.406073Z", "completed_at": "2025-11-20T22:55:16.498117Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.10593795776367188, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_opp_cards_battle_log", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_opp_cards_battle_log\"\n)\nselect distinct on (battle_id, opp_tag, card_id)\n    cast(battle_id as varchar(64)) as battle_id,\n    cast(opp_tag as varchar(10)) as battle_opp_tag,\n    card_id as battle_opp_card_id,\n    cast(card_level as smallint) as battle_opp_card_level,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by battle_id, opp_tag, card_id, snapshot_date", "relation_name": "\"cr_db\".\"public\".\"stg_opp_cards_battle_log\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.402751Z", "completed_at": "2025-11-20T22:55:16.405416Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.409638Z", "completed_at": "2025-11-20T22:55:16.499348Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.10671544075012207, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_player_cards", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_player_cards\"\n)\nselect distinct on (player_tag, card_id, snapshot_date)\n    cast(player_tag as varchar(10)) as player_tag,\n    cast(card_id as int) as player_card_id,\n    cast(card_level as smallint) as player_card_level,\n    coalesce(cast(card_evolution_level as smallint), 0) as player_card_evolution_level,\n    year,\n    month,\n    day,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by player_tag, card_id, snapshot_date", "relation_name": "\"cr_db\".\"public\".\"stg_player_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.397214Z", "completed_at": "2025-11-20T22:55:16.408956Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.414358Z", "completed_at": "2025-11-20T22:55:16.503170Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.1134943962097168, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_clans", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_clans\"\n)\nselect distinct on (tag, snapshot_date)\n    cast(tag as varchar(10)) as clan_tag,\n    cast(name as varchar(10)) as clan_name,\n    cast(type as varchar(11)) as clan_type,\n    cast(\"clanScore\" as int) as clan_score,\n    cast(\"clanWarTrophies\" as int) as clan_war_trophies,\n    cast(\"requiredTrophies\" as smallint) as clan_required_trophies,\n    cast(members as smallint) as clan_members,\n    cast(location::json->>'id' AS int) AS location_id,\n    cast(location::json->>'name' AS varchar(50)) AS location_name,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by tag, snapshot_date", "relation_name": "\"cr_db\".\"public\".\"stg_clans\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.429782Z", "completed_at": "2025-11-20T22:55:16.434423Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.436373Z", "completed_at": "2025-11-20T22:55:16.520824Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09781384468078613, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_player_cards_battle_log", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_player_cards_battle_log\"\n)\nselect distinct on (battle_id, player_tag, card_id)\n    cast(battle_id as varchar(64)) as battle_id,\n    cast(player_tag as varchar(10)) as battle_player_tag,\n    card_id as battle_player_card_id,\n    cast(card_level as smallint) as battle_player_card_level,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by battle_id, player_tag, card_id", "relation_name": "\"cr_db\".\"public\".\"stg_player_cards_battle_log\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.521821Z", "completed_at": "2025-11-20T22:55:16.529186Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.535751Z", "completed_at": "2025-11-20T22:55:16.617089Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.10589003562927246, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_players", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_players\"\n)\nselect distinct on (tag, snapshot_date)\n    cast(tag as varchar(10)) as player_tag,\n    cast(clan::json->>'tag' AS varchar(15)) AS clan_tag,\n    cast(\"currentFavouriteCard\"::json->>'id' AS varchar(50)) AS fav_card_id,\n\n    cast(name as varchar(15)) as player_name,\n    cast(\"expLevel\" as smallint) as player_exp_level,\n    cast(trophies as smallint) as player_trophies,\n\n    wins as player_wins,\n    losses as player_losses,\n    cast(\"battleCount\" as int) as player_battle_count,\n    cast(\"threeCrownWins\" as int) as player_three_crown_wins,\n    cast(\"warDayWins\" as smallint) as player_war_day_wins,\n\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by tag, snapshot_date", "relation_name": "\"cr_db\".\"public\".\"stg_players\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.524254Z", "completed_at": "2025-11-20T22:55:16.535138Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.539272Z", "completed_at": "2025-11-20T22:55:16.618866Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.10843658447265625, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_support_cards", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_support_cards\"\n)\nselect distinct on (card_id)\n    card_id as support_id,\n    cast(card_name as varchar(50)) as support_name,\n    cast(rarity as varchar(9)) as support_rarity,\n    cast(max_level as smallint) as support_max_level,\n    coalesce(cast(elixir_cost as smallint),0) as support_elixir_cost,\n    coalesce(cast(max_evolution_level as smallint), 0) as support_max_evolution_level\nfrom source_data", "relation_name": "\"cr_db\".\"public\".\"stg_support_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.516136Z", "completed_at": "2025-11-20T22:55:16.528153Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.529515Z", "completed_at": "2025-11-20T22:55:16.627046Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.11626553535461426, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.clash_royale_analytics.stg_player_support_card", "compiled": true, "compiled_code": "with source_data as (\n    select * from \"cr_db\".\"public\".\"landing_player_support_card\"\n)\nselect distinct on (player_tag, spp_id, snapshot_date)\n    cast(player_tag as varchar(10)) as player_tag,\n    cast(spp_id as int) as player_support_id,\n    cast(spp_level as smallint) as player_support_level,\n    year,\n    month,\n    day,\n    cast(snapshot_date as date) as snapshot_date\nfrom source_data\norder by player_tag, spp_id, snapshot_date", "relation_name": "\"cr_db\".\"public\".\"stg_player_support_card\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.545376Z", "completed_at": "2025-11-20T22:55:16.550050Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.550756Z", "completed_at": "2025-11-20T22:55:16.633881Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09599924087524414, "adapter_response": {"_message": "SELECT 11", "code": "SELECT", "rows_affected": 11}, "message": "SELECT 11", "failures": null, "unique_id": "model.clash_royale_analytics.dim_game_modes", "compiled": true, "compiled_code": "select distinct\n    game_mode_id,\n    game_mode_name\nfrom \"cr_db\".\"public\".\"stg_battle_info\"", "relation_name": "\"cr_db\".\"public\".\"dim_game_modes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.634608Z", "completed_at": "2025-11-20T22:55:16.641613Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.643304Z", "completed_at": "2025-11-20T22:55:16.734414Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.10944628715515137, "adapter_response": {"_message": "SELECT 260", "code": "SELECT", "rows_affected": 260}, "message": "SELECT 260", "failures": null, "unique_id": "model.clash_royale_analytics.fct_battles", "compiled": true, "compiled_code": "with battles as (\n    select * from \"cr_db\".\"public\".\"stg_battle_info\"\n)\n\nselect\n    md5(cast(coalesce(cast(battle_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(player_tag as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as battle_key,\n    -- JOIN dims\n    battle_id,\n    player_tag,\n    opp_tag,\n    game_mode_id,\n    \n    -- JOIN dim_date\n    snapshot_date, \n    battle_time,\n\n    -- stg metrics\n    player_crowns,\n    opp_crowns,\n    player_trophy_change,\n    player_elixir_leaked,\n\n    player_king_tower_hp,\n    player_left_tower_hp,\n    player_right_tower_hp,\n    \n    opp_king_tower_hp,\n    opp_left_tower_hp,\n    opp_right_tower_hp,\n    \n    -- calculated metrics\n\n    case when player_crowns > opp_crowns then 1 else 0 end as is_victory,\n\n    case when player_crowns = 3 then 1 else 0 end as is_three_crown_win,\n    \n    case when opp_left_tower_hp = 0 then 1 else 0 end as destroyed_left_tower,\n\n    case when opp_right_tower_hp = 0 then 1 else 0 end as destroyed_right_tower,\n\n    (\n        (case when opp_left_tower_hp = 0 then 1 else 0 end) +\n        (case when opp_right_tower_hp = 0 then 1 else 0 end) +\n        (case when opp_king_tower_hp = 0 then 1 else 0 end)\n    ) as total_towers_destroyed,\n\n    (player_king_tower_hp + player_left_tower_hp + player_right_tower_hp) as player_total_remaining_hp,\n\n    (opp_king_tower_hp + opp_left_tower_hp + opp_right_tower_hp) as opp_total_remaining_hp\n\nfrom battles", "relation_name": "\"cr_db\".\"public\".\"fct_battles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.638836Z", "completed_at": "2025-11-20T22:55:16.643028Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.650702Z", "completed_at": "2025-11-20T22:55:16.736035Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.10866260528564453, "adapter_response": {"_message": "SELECT 4", "code": "SELECT", "rows_affected": 4}, "message": "SELECT 4", "failures": null, "unique_id": "model.clash_royale_analytics.dim_clans", "compiled": true, "compiled_code": "with clans as (\n    select\n        *,\n        row_number() over (\n            partition by clan_tag\n            order by snapshot_date desc\n        ) as rn\n    from \"cr_db\".\"public\".\"stg_clans\"\n)\nselect\n    clan_tag,\n    clan_name,\n    clan_type,\n    clan_score,\n    clan_war_trophies,\n    clan_required_trophies,\n    clan_members,\n    location_id,\n    location_name\nfrom clans\nwhere rn = 1", "relation_name": "\"cr_db\".\"public\".\"dim_clans\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.662146Z", "completed_at": "2025-11-20T22:55:16.665854Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.666262Z", "completed_at": "2025-11-20T22:55:16.739721Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.08727407455444336, "adapter_response": {"_message": "SELECT 6", "code": "SELECT", "rows_affected": 6}, "message": "SELECT 6", "failures": null, "unique_id": "model.clash_royale_analytics.dim_players", "compiled": true, "compiled_code": "with players as (\n    select\n        *,\n        row_number() over (\n            partition by player_tag\n            order by snapshot_date desc\n        ) as rn\n    from \"cr_db\".\"public\".\"stg_players\"\n)\nselect\n    player_tag,\n    clan_tag,\n    player_name,\n    player_exp_level,\n    player_trophies,\n    player_wins,\n    player_losses,\n    player_battle_count,\n    player_three_crown_wins,\n    player_war_day_wins,\n    fav_card_id\nfrom players\nwhere rn = 1", "relation_name": "\"cr_db\".\"public\".\"dim_players\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.647224Z", "completed_at": "2025-11-20T22:55:16.655161Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.657068Z", "completed_at": "2025-11-20T22:55:16.781754Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1413276195526123, "adapter_response": {"_message": "SELECT 4288", "code": "SELECT", "rows_affected": 4288}, "message": "SELECT 4288", "failures": null, "unique_id": "model.clash_royale_analytics.fct_cards_usage", "compiled": true, "compiled_code": "\n\nwith player_cards as (\n    select\n        battle_id,\n        battle_player_tag as player_tag,\n        battle_player_card_id as card_id,\n        battle_player_card_level as card_level,\n        snapshot_date,\n        'Player' as played_by\n    from \"cr_db\".\"public\".\"stg_player_cards_battle_log\"\n),\n\nopponent_cards as (\n    select\n        battle_id,\n        battle_opp_tag as player_tag,\n        battle_opp_card_id as card_id,\n        battle_opp_card_level as card_level,\n        snapshot_date,\n        'Opponent' as played_by\n    from \"cr_db\".\"public\".\"stg_opp_cards_battle_log\"\n),\n\nunioned_usage as (\n    select * from player_cards\n    union all\n    select * from opponent_cards\n)\n\nselect\n    -- \ud83d\udddd\ufe0f Surrogate Key OBLIGATORIA (3 columnas para unicidad)\n    md5(cast(coalesce(cast(battle_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(player_tag as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(card_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as usage_key,\n    \n    battle_id,\n    player_tag,\n    card_id,\n    card_level,\n    played_by,\n    snapshot_date\n    \nfrom unioned_usage", "relation_name": "\"cr_db\".\"public\".\"fct_cards_usage\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.755766Z", "completed_at": "2025-11-20T22:55:16.765370Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.771229Z", "completed_at": "2025-11-20T22:55:16.823466Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.07526373863220215, "adapter_response": {"_message": "SELECT 125", "code": "SELECT", "rows_affected": 125}, "message": "SELECT 125", "failures": null, "unique_id": "model.clash_royale_analytics.dim_cards", "compiled": true, "compiled_code": "with cards as (\n    select\n        card_id,\n        card_name,\n        card_rarity,\n        card_max_level,\n        card_elixir_cost,\n        card_max_evolution_level,\n        'Standard' as card_type\n    from \"cr_db\".\"public\".\"stg_cards\"\n),\n\nsupport_cards as (\n    select\n        support_id as card_id,\n        support_name as card_name,\n        support_rarity as card_rarity,\n        support_max_level as card_max_level,\n        support_elixir_cost as card_elixir_cost,\n        support_max_evolution_level as card_max_evolution_level,\n        'Support' as card_type\n    from \"cr_db\".\"public\".\"stg_support_cards\"\n),\n\nunioned_data as (\n    select * from cards\n    union all\n    select * from support_cards\n)\n\nselect distinct on (card_id) *\nfrom unioned_data\norder by card_id", "relation_name": "\"cr_db\".\"public\".\"dim_cards\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.758555Z", "completed_at": "2025-11-20T22:55:16.770879Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.775168Z", "completed_at": "2025-11-20T22:55:16.827925Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0790243148803711, "adapter_response": {"_message": "SELECT 162", "code": "SELECT", "rows_affected": 162}, "message": "SELECT 162", "failures": null, "unique_id": "model.clash_royale_analytics.fct_player_card_holdings", "compiled": true, "compiled_code": "with standard_cards as (\n    select\n        player_tag,\n        player_card_id as card_id,\n        player_card_level as card_level,\n        player_card_evolution_level,\n        snapshot_date,\n        'Standard' as card_type_category\n    from \"cr_db\".\"public\".\"stg_player_cards\"\n),\n\nsupport_cards as (\n    select\n        player_tag,\n        player_support_id as card_id,\n        player_support_level as card_level,\n        0 as player_card_evolution_level,\n        snapshot_date,\n        'Support' as card_type_category\n    from \"cr_db\".\"public\".\"stg_player_support_card\"\n),\n\nunioned_holdings as (\n    select * from standard_cards\n    union all\n    select * from support_cards\n)\n\nselect \n    md5(cast(coalesce(cast(player_tag as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(card_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(snapshot_date as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as holding_key,\n    player_tag,\n    card_id,\n    snapshot_date,\n    card_level,\n    card_type_category\n\nfrom unioned_holdings", "relation_name": "\"cr_db\".\"public\".\"fct_player_card_holdings\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-11-20T22:55:16.751817Z", "completed_at": "2025-11-20T22:55:16.761891Z"}, {"name": "execute", "started_at": "2025-11-20T22:55:16.765729Z", "completed_at": "2025-11-20T22:55:16.829525Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.08224940299987793, "adapter_response": {"_message": "SELECT 18", "code": "SELECT", "rows_affected": 18}, "message": "SELECT 18", "failures": null, "unique_id": "model.clash_royale_analytics.fct_player_daily_stats", "compiled": true, "compiled_code": "with player_stats as (\n    select * from \"cr_db\".\"public\".\"stg_players\"\n),\nclan_activity as (\n    select * from \"cr_db\".\"public\".\"stg_clan_members\"\n)\n\nselect\n    md5(cast(coalesce(cast(p.player_tag as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(p.snapshot_date as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as daily_stats_key,\n    p.player_tag,\n    p.clan_tag,\n    p.snapshot_date,\n        \n    p.player_trophies as total_trophies,\n    p.player_wins as total_wins,\n\n    c.member_donations as week_total_donations,\n    c.member_donations_received as week_total_donations_received,\n    \n    -- daily donations\n    case \n        when coalesce(c.member_donations, 0) < lag(coalesce(c.member_donations, 0), 1, 0) over (partition by p.player_tag order by p.snapshot_date)\n        -- weekly donations restarted\n        then coalesce(c.member_donations, 0)\n        -- weekly report\n        else coalesce(c.member_donations, 0) - lag(coalesce(c.member_donations, 0), 1, 0) over (partition by p.player_tag order by p.snapshot_date)\n    end as estimated_daily_donations,\n\n    -- trophy change\n    p.player_trophies - lag(p.player_trophies, 1, p.player_trophies) over (\n        partition by p.player_tag \n        order by p.snapshot_date\n    ) as daily_trophy_change,\n        \n    -- daily wins\n    p.player_wins - lag(p.player_wins, 1, p.player_wins) over (\n        partition by p.player_tag \n        order by p.snapshot_date\n    ) as daily_wins,\n        \n    -- daily battles\n    p.player_battle_count - lag(p.player_battle_count, 1, p.player_battle_count) over (\n        partition by p.player_tag \n        order by p.snapshot_date\n    ) as daily_battles_played\n\n\n\nfrom player_stats p \nleft join clan_activity c\non p.player_tag = c.member_tag \nand p.snapshot_date = c.snapshot_date", "relation_name": "\"cr_db\".\"public\".\"fct_player_daily_stats\"", "batch_results": null}], "elapsed_time": 0.8617997169494629, "args": {"vars": {}, "exclude": [], "partial_parse_file_diff": true, "log_file_max_bytes": 10485760, "require_all_warnings_handled_by_warn_error": false, "show_all_deprecations": false, "state_modified_compare_more_unrendered_values": false, "introspect": true, "printer_width": 80, "use_colors_file": true, "invocation_command": "dbt run", "use_colors": true, "require_yaml_configuration_for_mf_time_spines": false, "macro_debugging": false, "log_format_file": "debug", "favor_state": false, "require_nested_cumulative_type_params": false, "project_dir": "/opt/airflow/dbt/clash_royale_analytics", "partial_parse": true, "require_explicit_package_overrides_for_builtin_materializations": true, "require_generic_test_arguments_property": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "empty": false, "skip_nodes_if_on_run_start_fails": false, "upload_to_artifacts_ingest_api": false, "validate_macro_args": false, "print": true, "require_resource_names_without_spaces": true, "log_level_file": "debug", "write_json": true, "which": "run", "state_modified_compare_vars": false, "strict_mode": false, "defer": false, "populate_cache": true, "use_fast_test_edges": false, "source_freshness_run_project_hooks": true, "static_parser": true, "show_resource_report": false, "log_path": "/opt/airflow/dbt/clash_royale_analytics/logs", "cache_selected_only": false, "send_anonymous_usage_stats": true, "profiles_dir": "/home/airflow/.dbt", "quiet": false, "select": [], "require_batched_execution_for_custom_microbatch_strategy": false, "indirect_selection": "eager", "version_check": true, "log_level": "info", "log_format": "default"}}